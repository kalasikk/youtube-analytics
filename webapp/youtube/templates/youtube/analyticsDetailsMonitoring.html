{% extends "mainApp/wrapper.html" %}



{% block pageContent %}

  <!-- Page Content -->
  <div class="container">


    <h3>{{channel.title}}</h3>
    <!-- Area Chart -->
    <div class="col-xl-10 col-lg-7">
        <div class="card shadow mb-4" style="width: 1000px;">
          <!-- Card Body -->
          <div class="card-body" style="height: 500px; width: 1000px;">
            <div class="chart-area">
              <canvas id="myLineChart" data-url="{% url 'videos-line-chart' sChannelId=channel.channel_id %}"></canvas>
            </div>
          </div>
        </div>
      </div>
    
  </div>
  <!-- /.container -->

  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
<script>
  
  function getRandomRgb(iNumberOfData) {
    let aRGBA = []
    for(let i = 0; i < iNumberOfData;i++){
      var num = Math.round(0xffffff * Math.random());
      var r = num >> 16;
      var g = num >> 8 & 255;
      var b = num & 255;
      aRGBA.push('rgb(' + r + ', ' + g + ', ' + b + ')');
    }
    return aRGBA
}

  function onInitVideosLineCanvas(aLabels,aData,aVideoTitles){
    const ctx = document.getElementById('myLineChart').getContext('2d');
    const aBackgroundColors = getRandomRgb(aData.length)
    const aBackgroundBorders = aBackgroundColors
    let aDataset = [];
    for(let i=0;i<aData.length;i++){
      aDataset.push({
              label: aVideoTitles[i],
              data: aData[i],
              fill: false,
              backgroundColor: aBackgroundColors[i],
              borderColor: aBackgroundBorders[i],
              borderWidth: 1
      })
    }
    const myChart = new Chart(ctx, {
      type: 'line',
      data: {
          labels: aLabels,
          datasets: aDataset
      },
      options: {
          responsive: true,
          title:{
            display: true,
            text: 'Videos View Count'
          },
        //   tooltips:{
        //     mode: 'index',
        //     intersect:false
        //   },
        //   hover:{
        //     mode: 'nearest',
        //     intersect: true
        //   },
          scales: {
              xAxes:[{
                  display:true,
                  scaleLabel:{
                      display:true,
                      labelString: 'Day'
                  }
              }],
              yAxes:[{
                  display:true,
                  scaleLabel:{
                      display:true,
                      labelString: 'View'
                  }
              }],
          }
      }
  });
  }

$(function () {
  const $lineChart = $("#myLineChart");
$.ajax({
  url: $lineChart.data("url"),
  success: function (data) {
    let aData = Object.values(data.data);
    const iLabelsNumber = data.labels.length;
    
    aData.map((aDataArray,iIndex)=>{
      if(aDataArray.length < iLabelsNumber){
        let iDataArrayLen = aDataArray.length;
        for(let i=0; i < iLabelsNumber - iDataArrayLen;i++){
          aDataArray.unshift(null)
        }
      }
    })

    onInitVideosLineCanvas(data.labels,aData,Object.keys(data.data))
    }

  })
});


</script>

{% endblock %}